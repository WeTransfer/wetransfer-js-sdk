language: node_js
cache:
  directories:
  - node_modules
node_js:
- 8
branches:
  only:
  - master
env:
  global:
  - CC_TEST_REPORTER_ID=0b103cd0a4a79d0a859c2f04327f27eded9fc9363c15b2cc2497bcd08fcc5b55
  - secure: cfvhAUhZKLEphzAnSdfz2dyxyL5qQ6vP0fkIsCEwU7gwhcyr7TaZjQBesztYqHhQIVl5F3s4aeTlxrvfkTxvpPHSaOoEPJ2W8cEZTjn6zUXcyqTZMONLAyByC2WTic1e1igcEkYotsJthjFIcBVlHi+NGWRgFaoiO62RgI55+sCvJqoYv96Pdcb869EDnEhf/e6w9ikBNQOZM4JThM7qN/Xvygy3c9Qfy7ypjHvgLTJ6YYM9rquerVmV23UEU28rUUW1xYJ6et4tUElIUm6ydwPuyj3GjYD7/vX9fb85SAO1RkBE+aB7GQGkLcRJWNuDMS0ZgSrJiHCWtNepAxl2YhcXO7Lr8svc06F4IB6X0p4W4Lf+h61oSIhXR9Is1lZLwhU7jvZxi2T1paaZF0xSAUntSwTdGmRK/5iLlXeZLx+ONqCd/N8fMIqG4sHAucEY4tY+Y9DqdRvpk7s5WRQxGsUhNCKLgssZzQWzxzrr6Y8Y4fBXkNo1WH8bgRj4kUZGIyLp6E1SbU8+6mj2l2srSKn82/29aQuGGXkrBuzV0GSHlhYB+mZRZZnIwBTV+4kXxpxdyBB3kYFRoUY/kutYS/NY+gGxFaLMO0QGB1owfyVkFs5ZZjFpPB4ju4fEKbUXdAuAiGHmXxl/lzA8nbrxAEots70Lp9/HTZpKTSg8wAY=
jobs:
  include:
  - stage: Lint & unit tests
    install: yarn
    before_script:
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - "./cc-test-reporter before-build"
    script:
    - npm run lint
    - npm run test:ci
    after_script:
    - "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT ./coverage/lcov.info"
  - stage: Integration tests
    install: yarn
    script:
    - cd example && node create-transfer.js
